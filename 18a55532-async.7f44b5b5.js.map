{"version":3,"sources":[".dumi/hooks/useLottie.ts",".dumi/pages/index/components/Lottie.tsx"],"sourcesContent":["import type { AnimationConfig, AnimationItem, LottiePlayer } from 'lottie-web';\nimport React from 'react';\n\ninterface UseLottieOptions extends Omit<AnimationConfig, 'container' | 'renderer'> {\n  renderer?: 'svg' | 'canvas' | 'html';\n  lazyLoad?: boolean;\n  disabled?: boolean;\n  rootMargin?: string;\n  path?: string;\n}\n\n// 用于确保 lottie-web 只加载一次\nlet lottiePromise: Promise<LottiePlayer> | null = null;\n\nconst loadLottie = async (): Promise<LottiePlayer> => {\n  if (!lottiePromise) {\n    lottiePromise = new Promise((resolve, reject) => {\n      if ((window as any)?.lottie) {\n        resolve((window as any).lottie);\n        return;\n      }\n\n      const script = document.createElement('script');\n      script.src =\n        'https://gw.alipayobjects.com/os/lib/lottie-web/5.12.2/build/player/lottie_svg.min.js';\n      script.async = true;\n      script.onload = () => resolve((window as any).lottie);\n      script.onerror = reject;\n      document.body.appendChild(script);\n    });\n  }\n  return lottiePromise;\n};\n\nconst useLottie = (options: UseLottieOptions) => {\n  const { lazyLoad = true, rootMargin = '200px', disabled = false, ...lottieOptions } = options;\n  const stableLottieOptions = React.useMemo(() => lottieOptions, []);\n\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const [isIntersected, setIsIntersected] = React.useState(!lazyLoad);\n  const animationInstanceRef = React.useRef<AnimationItem | null>(null);\n  const [error, setError] = React.useState<Error | null>(null);\n  const [animationInstance, setAnimationInstance] = React.useState<AnimationItem>();\n  React.useEffect(() => {\n    if (disabled) return;\n    let mounted = true;\n\n    const initAnimation = async () => {\n      if (!animationInstanceRef.current && (!lazyLoad || isIntersected)) {\n        if (!containerRef.current) return;\n\n        try {\n          const lottie = await loadLottie();\n\n          if (!mounted) return;\n\n          const animation = lottie.loadAnimation({\n            container: containerRef.current,\n            renderer: 'svg', // 默认使用 SVG 渲染，性能更好\n            ...stableLottieOptions,\n          });\n          setAnimationInstance(animation);\n          animationInstanceRef.current = animation;\n        } catch (err) {\n          if (mounted) {\n            setError(err as Error);\n            console.error('Failed to load Lottie animation:', err);\n          }\n        }\n      }\n    };\n\n    initAnimation();\n\n    return () => {\n      mounted = false;\n      if (animationInstanceRef.current) {\n        animationInstanceRef.current.destroy();\n        animationInstanceRef.current = null;\n      }\n    };\n  }, [isIntersected, lazyLoad, stableLottieOptions, disabled]);\n\n  React.useEffect(() => {\n    if (disabled) return;\n\n    if (lazyLoad) {\n      const observer = new IntersectionObserver(\n        ([entry]) => {\n          if (entry.isIntersecting) {\n            setIsIntersected(true);\n          }\n        },\n        { root: null, rootMargin, threshold: 0 },\n      );\n\n      if (containerRef.current) {\n        observer.observe(containerRef.current);\n      }\n\n      return () => {\n        if (containerRef.current) {\n          observer.unobserve(containerRef.current);\n        }\n      };\n    }\n  }, [lazyLoad, rootMargin, disabled]);\n\n  return [\n    containerRef,\n    animationInstance,\n    {\n      isIntersected,\n      error,\n    },\n  ] as const;\n};\n\nexport default useLottie;\n","import type { AnimationItem } from 'lottie-web';\nimport React, { useEffect, useImperativeHandle } from 'react';\nimport useLottie from '../../../hooks/useLottie';\n\ninterface Props {\n  path: string;\n  className?: string;\n  onLoad?: (animation: AnimationItem, lottieRef: React.RefObject<HTMLDivElement | null>) => void;\n  config?: {\n    autoplay: boolean;\n  };\n  ref?: any;\n}\nconst Lottie: React.FC<Props> = ({ path, className, config, ref, onLoad }) => {\n  const [lottieRef, animation] = useLottie({\n    renderer: 'svg',\n    loop: false,\n    autoplay: config?.autoplay === undefined ? true : config?.autoplay,\n    path,\n  });\n\n  useImperativeHandle(ref, () => {\n    return {\n      animation,\n      lottieRef,\n    };\n  }, [animation, lottieRef.current]);\n\n  useEffect(() => {\n    if (!animation) return;\n    onLoad?.(animation, lottieRef);\n    return () => {\n      animation?.destroy();\n    };\n  }, [animation]);\n  return <div ref={lottieRef} className={className} />;\n};\n\nexport default Lottie;\n"],"names":[],"mappings":"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"}